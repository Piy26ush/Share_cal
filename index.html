<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stock Profit Calculator with Portfolio</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #333333;
      --primary-color: #007ea7;
      --secondary-bg: #f1f1f1;
      --button-bg: #007ea7;
      --button-hover: #005f73;
    }
    [data-theme="dark"] {
      --bg-color: #121212;
      --text-color: #ffffff;
      --primary-color: #00bcd4;
      --secondary-bg: #1e1e1e;
      --button-bg: #00bcd4;
      --button-hover: #008c9e;
    }
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 20px;
    }
    .calculator {
      background: var(--secondary-bg);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      width: 90%;
      max-width: 400px;
      margin-bottom: 30px;
    }
    h1 {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 20px;
      text-align: center;
      color: var(--primary-color);
    }
    label {
      font-weight: 600;
      margin-top: 15px;
      display: block;
    }
    input,
    select,
    button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
      background-color: var(--bg-color);
      color: var(--text-color);
    }
    button {
      background-color: var(--button-bg);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: var(--button-hover);
    }
    .output {
      background: var(--bg-color);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      border: 1px solid #ccc;
      min-height: 60px;
    }
    .portfolio {
      background: var(--secondary-bg);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      width: 90%;
      max-width: 600px;
    }
    .portfolio h2 {
      color: var(--primary-color);
      margin-bottom: 15px;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
    }
    th,
    td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background: var(--button-bg);
      color: white;
    }
    .no-data {
      text-align: center;
      padding: 15px;
      color: #666;
    }
    @media (max-width: 480px) {
      .calculator,
      .portfolio {
        padding: 20px;
      }
      h1 {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <div class="calculator" id="app">
    <h1>ðŸ“ˆ Stock Profit Calculator</h1>

    <label>Buy Price: <input type="number" id="buyPrice" /></label>
    <label>Sell Price: <input type="number" id="sellPrice" /></label>
    <label>Quantity: <input type="number" id="quantity" /></label>
    <label>Broker:
      <select id="broker">
        <option value="groww">Groww</option>
        <option value="angel">Angel One</option>
      </select>
    </label>
    <label>Trade Type:
      <select id="tradeType">
        <option value="delivery">Delivery</option>
        <option value="intraday">Intraday</option>
      </select>
    </label>

    <button onclick="calculate()">Calculate</button>
    <div class="output" id="result"></div>
    <button id="addPortfolioBtn" style="display:none;" onclick="addToPortfolio()">Add to Portfolio</button>
  </div>

  <div class="portfolio" id="portfolioSection" style="display:none;">
    <h2>ðŸ“‹ Your Portfolio</h2>
    <table id="portfolioTable">
      <thead>
        <tr>
          <th>Buy Price</th>
          <th>Sell Price</th>
          <th>Quantity</th>
          <th>Broker</th>
          <th>Trade Type</th>
          <th>Net P&L (â‚¹)</th>
        </tr>
      </thead>
      <tbody id="portfolioBody"></tbody>
    </table>
    <div class="no-data" id="noPortfolio">No trades added yet.</div>
    <button onclick="clearPortfolio()">Clear Portfolio</button>
  </div>

  <script>
    // Set theme based on user's OS/browser preference
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.setAttribute('data-theme', 'dark');
    } else {
      document.documentElement.setAttribute('data-theme', 'light');
    }

    let currentTrade = null;

    function calculate() {
      const buy = parseFloat(document.getElementById('buyPrice').value);
      const sell = parseFloat(document.getElementById('sellPrice').value);
      const qty = parseInt(document.getElementById('quantity').value);
      const broker = document.getElementById('broker').value;
      const tradeType = document.getElementById('tradeType').value;

      if (isNaN(buy) || isNaN(sell) || isNaN(qty) || qty <= 0) {
        alert('Please enter valid buy price, sell price and quantity.');
        return;
      }

      const buyValue = buy * qty;
      const sellValue = sell * qty;
      const turnover = buyValue + sellValue;
      const grossPL = sellValue - buyValue;

      let brokerage = 0;
      let stt = 0;
      let exchTxn = 0.0000345 * turnover;
      let sebi = 0.000001 * turnover;
      let gst = 0;
      let stampDuty = 0;
      let dpCharge = 0;

      if (tradeType === 'intraday') {
        brokerage = Math.min(20, 0.0003 * turnover);
        stt = 0.00025 * turnover;
        stampDuty = 0.00003 * buyValue;
      } else {
        brokerage = 0;
        stt = 0.001 * sellValue;
        stampDuty = 0.00015 * buyValue;
        dpCharge = 13.5;
      }

      gst = 0.18 * (brokerage + exchTxn);
      const totalCharges = brokerage + stt + exchTxn + sebi + gst + stampDuty + dpCharge;
      const netPLRaw = grossPL - totalCharges;

      const netPL = Math.abs(netPLRaw).toFixed(2);
      const profitOrLoss = netPLRaw >= 0 ? 'Profit' : 'Loss';

      document.getElementById('result').innerHTML = `
        <strong>Gross P&L:</strong> â‚¹${Math.abs(grossPL).toFixed(2)}<br>
        <strong>Total Charges:</strong> â‚¹${totalCharges.toFixed(2)}<br>
        <strong>Net ${profitOrLoss}:</strong> â‚¹${netPL}
      `;

      currentTrade = {
        buy, sell, qty, broker, tradeType, netPL: netPLRaw
      };

      document.getElementById('addPortfolioBtn').style.display = 'block';
    }

    function addToPortfolio() {
      if (!currentTrade) return;

      let portfolio = JSON.parse(localStorage.getItem('portfolio')) || [];
      portfolio.push(currentTrade);
      localStorage.setItem('portfolio', JSON.stringify(portfolio));
      currentTrade = null;

      document.getElementById('addPortfolioBtn').style.display = 'none';
      document.getElementById('result').innerHTML = '';
      document.getElementById('buyPrice').value = '';
      document.getElementById('sellPrice').value = '';
      document.getElementById('quantity').value = '';

      renderPortfolio();
    }

    function renderPortfolio() {
      const portfolio = JSON.parse(localStorage.getItem('portfolio')) || [];
      const tbody = document.getElementById('portfolioBody');
      const noData = document.getElementById('noPortfolio');
      const portfolioSection = document.getElementById('portfolioSection');

      if (portfolio.length === 0) {
        portfolioSection.style.display = 'none';
        return;
      }

      portfolioSection.style.display = 'block';
      tbody.innerHTML = '';

      portfolio.forEach((trade, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>â‚¹${trade.buy.toFixed(2)}</td>
          <td>â‚¹${trade.sell.toFixed(2)}</td>
          <td>${trade.qty}</td>
          <td>${trade.broker}</td>
          <td>${trade.tradeType}</td>
          <td>${trade.netPL >= 0 ? 'Profit' : 'Loss'} â‚¹${Math.abs(trade.netPL).toFixed(2)}</td>
        `;
        tbody.appendChild(tr);
      });

      noData.style.display = 'none';
    }

    function clearPortfolio() {
      if (confirm('Are you sure you want to clear your portfolio?')) {
        localStorage.removeItem('portfolio');
        renderPortfolio();
      }
    }

    // Render portfolio on page load
    renderPortfolio();
  </script>
</body>
</html>
